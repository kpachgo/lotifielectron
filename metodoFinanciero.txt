Perfecto üëå aqu√≠ tienes un resumen claro, t√©cnico y ordenado de **los dos m√©todos financieros que est√°s usando**, c√≥mo se reflejan en la base de datos y c√≥mo se calculan.

# üè¶ LOS DOS M√âTODOS FINANCIEROS DEL SISTEMA

Tu sistema soporta **dos motores financieros distintos**, definidos en:
contratos.tipo_financiamiento

Valores:

* `'interes_saldo'`
* `'penalizacion_fija'`

# üîµ 1Ô∏è‚É£ M√âTODO: INTER√âS SOBRE SALDO (30/360)

## üìå Concepto

* Cuotas fijas.
* Inter√©s mensual sobre el capital pendiente.
* El capital pendiente disminuye con cada pago.
* No usa d√≠as de gracia.
* No hay penalizaci√≥n fija.
* Puede pagarse m√°s que la cuota (abono a capital).

## üìä C√≥mo se refleja en la base de datos

### En `contratos`

Campos utilizados:

* `tipo_financiamiento = 'interes_saldo'`
* `tasa_interes_anual`
* `capital_pendiente`
* `cuota`
* `monto_financiado`

`penalizacion_fija` ‚Üí NULL
`dias_gracia` ‚Üí no se usa

---

### En `cuotas`

* `monto_cuota` ‚Üí cuota fija mensual
* `estado`
* `interes_generado`
* `capital_pendiente` (cuota fija)

---

### En `pagos`

* `abono_interes`
* `abono_capital`
* `monto_total`

---

## üßÆ C√≥mo se calcula

### üìå Inter√©s mensual (m√©todo 30/360)

```
Inter√©s = CapitalPendiente √ó (TasaAnual / 100) √ó 30 / 360
```

Ejemplo:

Capital pendiente: 27,500
Tasa anual: 16%

```
Inter√©s = 27,500 √ó 0.16 √ó 30 / 360
Inter√©s = 366.67
```

---

## üí∞ Orden de aplicaci√≥n del pago

Cuando el cliente paga:

1Ô∏è‚É£ Primero se paga inter√©s
2Ô∏è‚É£ Luego capital
3Ô∏è‚É£ Se reduce `contratos.capital_pendiente`

Si paga m√°s que la cuota:

* El excedente va directo a capital.
* Puede liquidar antes del plazo.

---

## üìâ Qu√© ocurre cada mes

* El capital pendiente baja.
* El inter√©s del siguiente mes baja.
* La cuota es fija, pero la proporci√≥n inter√©s/capital cambia.

---

# üü¢ 2Ô∏è‚É£ M√âTODO: PENALIZACI√ìN FIJA POR CUOTA VENCIDA

## üìå Concepto

* Cuotas fijas.
* No hay inter√©s financiero.
* Solo penalizaci√≥n fija si hay atraso.
* La penalizaci√≥n no aumenta.
* Aplica solo si el atraso supera los d√≠as de gracia.

---

## üìä C√≥mo se refleja en la base de datos

### En `contratos`

Campos utilizados:

* `tipo_financiamiento = 'penalizacion_fija'`
* `penalizacion_fija`
* `dias_gracia`
* `cuota`
* `capital_pendiente`

`tasa_interes_anual` ‚Üí NULL

---

### En `cuotas`

* `monto_cuota`
* `penalizacion_aplicada`
* `estado`

---

### En `pagos`

* `abono_mora`
* `abono_capital`
* `monto_total`

---

## üßÆ C√≥mo se calcula

### üìå Primero se calculan d√≠as de atraso

```
diasAtraso = fechaActual - fecha_vencimiento
```

---

### üìå Regla

Si:

```
diasAtraso > dias_gracia
```

Entonces:

```
penalizacion = penalizacion_fija
```

Si no:

```
penalizacion = 0
```

---

## üí∞ Total a pagar

```
Total = cuota + penalizacion
```

---

## üí≥ Orden de aplicaci√≥n del pago

1Ô∏è‚É£ Primero paga penalizaci√≥n
2Ô∏è‚É£ Luego capital
3Ô∏è‚É£ Se reduce `contratos.capital_pendiente`

---

# üîé Diferencia clave entre ambos motores

| Caracter√≠stica        | Inter√©s sobre saldo | Penalizaci√≥n fija |
| --------------------- | ------------------- | ----------------- |
| Inter√©s financiero    | ‚úÖ S√≠                | ‚ùå No              |
| Penalizaci√≥n fija     | ‚ùå No                | ‚úÖ S√≠              |
| Usa d√≠as de gracia    | ‚ùå No                | ‚úÖ S√≠              |
| Inter√©s baja cada mes | ‚úÖ S√≠                | ‚ùå No aplica       |
| Permite abono extra   | ‚úÖ S√≠                | ‚úÖ S√≠              |

---

# üß† C√≥mo decide el sistema qu√© motor usar

En backend:

```js
if (contrato.tipo_financiamiento === 'interes_saldo') {
   // calcular inter√©s 30/360
}

if (contrato.tipo_financiamiento === 'penalizacion_fija') {
   // aplicar penalizaci√≥n fija si corresponde
}
```

---

# üèó Arquitectura financiera actual

* Las cuotas son calendario fijo.
* El capital real vive en `contratos.capital_pendiente`.
* El pago siempre se descompone:

  * inter√©s
  * mora
  * capital
* El sistema permite liquidaci√≥n anticipada.
* Se pueden adjuntar comprobantes digitales.
* Se guarda n√∫mero de recibo f√≠sico.

============================================
use lotifi;
-- 1Ô∏è‚É£ Desactivar llaves for√°neas
SET FOREIGN_KEY_CHECKS = 0;

-- 2Ô∏è‚É£ Vaciar tablas (reinicia AUTO_INCREMENT)
TRUNCATE TABLE recibos;
TRUNCATE TABLE pagos;
TRUNCATE TABLE cuotas;
TRUNCATE TABLE contratos;
TRUNCATE TABLE reservas;
TRUNCATE TABLE documentos;
TRUNCATE TABLE gastos;
TRUNCATE TABLE lotes;
TRUNCATE TABLE poligonos;
TRUNCATE TABLE lotificaciones;
TRUNCATE TABLE cliente;

-- 3Ô∏è‚É£ Reactivar llaves for√°neas
SET FOREIGN_KEY_CHECKS = 1;
